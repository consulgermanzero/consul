<% cache [locale_and_user_status, @current_order, commentable_cache_key(@debate), @comment_tree.comments, @comment_tree.comment_authors, @debate.comments_count, @comment_flags] do %>
  <div class="row comments">
    <div id="comments" class="small-12 column">
      <h3>
        <%= t("debates.show.comments_title") %>
        <span class="js-comments-count">(<%= @debate.comments_count %>)</span>
      </h3>

      <%= render "shared/wide_order_selector", i18n_namespace: "comments" %>

      <% tag_names = @debate.tags.category.pluck(:name) %>
      <% if tag_names.include?("Verkehr") %>
        <div>
          <p style="color:red">Für den Sektor <strong>"Verkehr"</strong> haben wir die Kommentierung am 3. Mai beendet.
          Die Ergebnisse werden jetzt für die weitere Gesetzesarbeit ausgewertet.</p>
        </div>
      <% elsif tag_names.include?("Energie") %>
        <div>
          <p style="color:red">Für den Sektor <strong>"Energie"</strong> haben wir die Kommentierung am 22. April beendet.
          Die Ergebnisse werden jetzt für die weitere Gesetzesarbeit ausgewertet.</p>
        </div>
      <% elsif tag_names.include?("Landwirtschaft") %>
        <div>
          <p style="color:red">Für den Sektor <strong>"Landwirtschaft, Landnutzung und Ernährung"</strong> haben wir die Kommentierung am 15. März beendet. 
          Die Ergebnisse werden jetzt für die weitere 
          <br>Gesetzesarbeit ausgewertet.</p>
        </div>
      <% else %>
        <% if user_signed_in? %>
          <%= render "comments/form", { commentable: @debate, parent_id: nil, toggeable: false } %>
        <% else %>
          <br>
          <%= render "shared/login_to_comment" %>
        <% end %>
      <% end %>

      <% @comment_tree.root_comments.each do |comment| %>
        <%= render "comments/comment", comment: comment %>
      <% end %>
      <%= paginate @comment_tree.root_comments %>
    </div>
  </div>
<% end %>
